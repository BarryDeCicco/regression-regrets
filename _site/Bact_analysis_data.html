<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Regression without regrets - 1&nbsp; Analysis ready data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Bact_missing.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Analysis ready data</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Regression without regrets</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Bact_analysis_data.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Analysis ready data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Bact_missing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Results of IDA: Missing values</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Bact_univar.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Univariate distribution checks</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#analysis-ready-dataset" id="toc-analysis-ready-dataset" class="nav-link active" data-scroll-target="#analysis-ready-dataset"><span class="toc-section-number">1.1</span>  Analysis ready dataset</a></li>
  <li><a href="#steps" id="toc-steps" class="nav-link" data-scroll-target="#steps"><span class="toc-section-number">1.2</span>  Steps</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="ARD" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Analysis ready data</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p>Based on the IDA plan prepare the data to be analysis ready: read, clean and tidy.</p>
<section id="analysis-ready-dataset" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="analysis-ready-dataset"><span class="header-section-number">1.1</span> Analysis ready dataset</h2>
<p>The aim of this section and the remaining chapters of the report are to document the steps taken towards transforming the <em>source</em> data set to an <em>analysis ready</em> data set.</p>
<p>In this section, additional meta-data is added to the <em>source</em> data set.</p>
<p>We write this new modified (annotated) data set back to the <code>data</code> folder after adding additional meta-data for all variables. The meta-data is taken from the data dictionary. The aim is to produce an analysis ready data set for the research objective.</p>
<p>At the stage we could select the variables of interest to take in to the IDA phase by dropping variables we do not check in IDA.</p>
</section>
<section id="steps" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="steps"><span class="header-section-number">1.2</span> Steps</h2>
<p>Read in the source data dictionary</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 53 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (6): Variable, Label, Scale.of.measurement, Units, Remark, From.paper
dbl (1): VariableNr

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Read in the source data.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 14691 Columns: 53
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (1): BloodCulture
dbl (52): ID, SEX, AGE, MCV, HGB, HCT, PLT, MCH, MCHC, RDW, MPV, LYM, MONO, ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Transform source data t long format for lab measurements. This will enable efficeint processing later.</p>
<div class="cell">

</div>
<p>Add the parameter information such as labels and units on to the transformed data directly from the data dictionary.</p>
<p>Derive additional variables and metadata are per the analysis plan such as:</p>
<ul>
<li>Units</li>
<li>Variable type</li>
<li>Categories for sex</li>
<li>rename outcome</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 719,859
Columns: 23
$ ID                   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ SEX                  &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
$ AGE                  &lt;dbl&gt; 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 6…
$ BloodCulture         &lt;chr&gt; "no", "no", "no", "no", "no", "no", "no", "no", "…
$ PARAMCD              &lt;chr&gt; "MCV", "HGB", "HCT", "PLT", "MCH", "MCHC", "RDW",…
$ AVAL                 &lt;dbl&gt; 99.30, 11.50, 35.90, 307.00, 31.50, 31.80, 19.50,…
$ variable_nr          &lt;dbl&gt; 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,…
$ variable             &lt;chr&gt; "MCV", "HGB", "HCT", "PLT", "MCH", "MCHC", "RDW",…
$ label                &lt;chr&gt; "Mean corpuscular volume", "Haemoglobin", "Haemat…
$ scale_of_measurement &lt;chr&gt; "continuous", "continuous", "continuous", "contin…
$ units                &lt;chr&gt; "pg", "G/L", "%", "G/L", "fl", "g/dl", "%", "fl",…
$ remark               &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "…
$ from_paper           &lt;chr&gt; "MCV (pg) 15,941 88.1 (84.6?91.9) 88.6 (84.8?92.5…
$ UNIT                 &lt;chr&gt; "pg", "G/L", "%", "G/L", "fl", "g/dl", "%", "fl",…
$ TYPE                 &lt;chr&gt; "numeric", "numeric", "numeric", "numeric", "nume…
$ NOTE                 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "…
$ NOTE2                &lt;chr&gt; "MCV (pg) 15,941 88.1 (84.6?91.9) 88.6 (84.8?92.5…
$ SEXC                 &lt;chr&gt; "female", "female", "female", "female", "female",…
$ SUBJID               &lt;dbl&gt; 100001, 100001, 100001, 100001, 100001, 100001, 1…
$ USUBJID              &lt;chr&gt; "DC-2019-0054-100001", "DC-2019-0054-100001", "DC…
$ PARAM                &lt;chr&gt; "Mean corpuscular volume (pg)", "Haemoglobin (G/L…
$ BACTEREMIA           &lt;chr&gt; "no", "no", "no", "no", "no", "no", "no", "no", "…
$ BACTEREMIAN          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</code></pre>
</div>
</div>
<p>Select and re-roder the variables as per the data set specification.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 719,859
Columns: 14
$ USUBJID     &lt;chr&gt; "DC-2019-0054-100001", "DC-2019-0054-100001", "DC-2019-005…
$ SUBJID      &lt;dbl&gt; 100001, 100001, 100001, 100001, 100001, 100001, 100001, 10…
$ AGE         &lt;dbl&gt; 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62…
$ SEX         &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
$ SEXC        &lt;chr&gt; "female", "female", "female", "female", "female", "female"…
$ BACTEREMIA  &lt;chr&gt; "no", "no", "no", "no", "no", "no", "no", "no", "no", "no"…
$ BACTEREMIAN &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ PARAM       &lt;chr&gt; "Mean corpuscular volume (pg)", "Haemoglobin (G/L)", "Haem…
$ PARAMCD     &lt;chr&gt; "MCV", "HGB", "HCT", "PLT", "MCH", "MCHC", "RDW", "MPV", "…
$ AVAL        &lt;dbl&gt; 99.30, 11.50, 35.90, 307.00, 31.50, 31.80, 19.50, 10.80, 0…
$ UNIT        &lt;chr&gt; "pg", "G/L", "%", "G/L", "fl", "g/dl", "%", "fl", "G/L", "…
$ TYPE        &lt;chr&gt; "numeric", "numeric", "numeric", "numeric", "numeric", "nu…
$ NOTE        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "Measures …
$ NOTE2       &lt;chr&gt; "MCV (pg) 15,941 88.1 (84.6?91.9) 88.6 (84.8?92.5) 0.0044 …</code></pre>
</div>
</div>
<p>Add variable metadata as label attributes</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 719,859
Columns: 14
$ USUBJID     &lt;chr&gt; "DC-2019-0054-100001", "DC-2019-0054-100001", "DC-2019-005…
$ SUBJID      &lt;dbl&gt; 100001, 100001, 100001, 100001, 100001, 100001, 100001, 10…
$ AGE         &lt;dbl&gt; 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62…
$ SEX         &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
$ SEXC        &lt;chr&gt; "female", "female", "female", "female", "female", "female"…
$ BACTEREMIA  &lt;chr&gt; "no", "no", "no", "no", "no", "no", "no", "no", "no", "no"…
$ BACTEREMIAN &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ PARAM       &lt;chr&gt; "Mean corpuscular volume (pg)", "Haemoglobin (G/L)", "Haem…
$ PARAMCD     &lt;chr&gt; "MCV", "HGB", "HCT", "PLT", "MCH", "MCHC", "RDW", "MPV", "…
$ AVAL        &lt;dbl&gt; 99.30, 11.50, 35.90, 307.00, 31.50, 31.80, 19.50, 10.80, 0…
$ UNIT        &lt;chr&gt; "pg", "G/L", "%", "G/L", "fl", "g/dl", "%", "fl", "G/L", "…
$ TYPE        &lt;chr&gt; "numeric", "numeric", "numeric", "numeric", "numeric", "nu…
$ NOTE        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "Measures …
$ NOTE2       &lt;chr&gt; "MCV (pg) 15,941 88.1 (84.6?91.9) 88.6 (84.8?92.5) 0.0044 …</code></pre>
</div>
</div>
<p>Check we have not introduced any errors with the outcome variable.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    no    yes 
662039  57820 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    no    yes 
662039  57820 </code></pre>
</div>
</div>
<p>Set flags for predictors as per the IDA plan:</p>
<ul>
<li><p>age (AGE), leukocytes (WBC), blood urea neutrogen (BUN), creatinine (CREA), thrombocytes (PLT), and neutrophiles (NEU) and these predictors will be included in the model as key predictors</p></li>
<li><p>Predictors of medium importance are potassium (POTASS), and some acute-phase related parameters such as fibrinogen (FIB), C-reactive protein (CRP), aspartate transaminase (ASAT), alanine transaminase (ALAT), and gamma-glutamyl transpeptidase (GGT).</p></li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 719,859
Columns: 17
$ USUBJID     &lt;chr&gt; "DC-2019-0054-100001", "DC-2019-0054-100001", "DC-2019-005…
$ SUBJID      &lt;dbl&gt; 100001, 100001, 100001, 100001, 100001, 100001, 100001, 10…
$ AGE         &lt;dbl&gt; 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62…
$ SEX         &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
$ SEXC        &lt;chr&gt; "female", "female", "female", "female", "female", "female"…
$ BACTEREMIA  &lt;chr&gt; "no", "no", "no", "no", "no", "no", "no", "no", "no", "no"…
$ BACTEREMIAN &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ PARAM       &lt;chr&gt; "Mean corpuscular volume (pg)", "Haemoglobin (G/L)", "Haem…
$ PARAMCD     &lt;chr&gt; "MCV", "HGB", "HCT", "PLT", "MCH", "MCHC", "RDW", "MPV", "…
$ AVAL        &lt;dbl&gt; 99.30, 11.50, 35.90, 307.00, 31.50, 31.80, 19.50, 10.80, 0…
$ UNIT        &lt;chr&gt; "pg", "G/L", "%", "G/L", "fl", "g/dl", "%", "fl", "G/L", "…
$ TYPE        &lt;chr&gt; "numeric", "numeric", "numeric", "numeric", "numeric", "nu…
$ NOTE        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "Measures …
$ NOTE2       &lt;chr&gt; "MCV (pg) 15,941 88.1 (84.6?91.9) 88.6 (84.8?92.5) 0.0044 …
$ KEY_PRED_FL &lt;chr&gt; NA, NA, NA, "Y", NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ MED_PRED_FL &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "Y…
$ REM_PRED_FL &lt;chr&gt; "Y", "Y", "Y", NA, "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y",…</code></pre>
</div>
</div>
<p>TODO: something with this text? <em>“For example, leukocytes consist of five different types of blood cells (BASO, EOS, NEU, LYM and MONO), and the sum of the concentration of these types approximately (but not exactly) gives the leukocyte count, which is recorded in the variable WBC. Moreover, these variables are given as absolute counts and as percentages of the sum of the five variables, which creates some correlation. Some laboratory variables differ by sex and age, but the special selection of patients for this study (suspicion of bacteremia) may distort or alter the expected correlations with sex and age.”</em></p>
<p>Derive age groups: For the purpose of stratifying IDA results by age, age will be categorized into the following three groups: [16, 50], (50, 65], (65, 101].</p>
<div class="cell">

</div>
<p>Save the analysis data sets in to two linked data sets following a strucutre similar to the CDISC ADaM data standard. Individual patient measurements are stored in a data set called ADSL. The lab specifific data sets are stored in ADLB (a long format data set).</p>
<p>ADSL:</p>
<div class="cell">

</div>
<p>ADLB: <em>Note AGE is kept in ADLB as it is a key predictor</em></p>
<div class="cell">

</div>
<p>Note. At this point both ADSL and ADLB are intermediate files that will be used for further IDA. Findings in IDA may require updates to either data set.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Bact_missing.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Results of IDA: Missing values</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb9" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Analysis ready data {#ARD}</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ard01, warning=FALSE, message=FALSE}</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Load libraries for this chapter</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyselect)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>Based on the IDA plan prepare the data to be analysis ready: read, clean and tidy. </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analysis ready dataset</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>The aim of this section and the remaining chapters of the report are to document the steps taken towards transforming the *source* data set to an *analysis ready* data set.</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>In this section, additional meta-data is added to the *source* data set. </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>We write this new modified (annotated) data set back to the <span class="in">`data`</span> folder after adding additional meta-data for all variables. The meta-data is taken from the data dictionary. The aim is to produce an analysis ready data set for the research objective. </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>At the stage we could select the variables of interest to take in to the IDA phase by dropping variables we do not check in IDA.</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Steps</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>Read in the source data dictionary </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r read_dict}</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="do">## Read in the source data dictionary and display </span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>bact_dd <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data-raw"</span>, <span class="st">"Bacteremia_public_S2_Data_Dictionary.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(VariableNr) <span class="sc">|&gt;</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PARAMCD =</span> variable )</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>Read in the source data.</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="in">```{r read_source}</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Read in the source data </span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>bact_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data-raw"</span>, <span class="st">"Bacteremia_public_S2.csv"</span>)) </span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>Transform source data t long format for lab measurements. This will enable efficeint processing later. </span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{r contents_abact, warning=FALSE, message=FALSE, echo=FALSE} </span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="do">## transform </span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>bact_data01 <span class="ot">&lt;-</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>  bact_data <span class="sc">|&gt;</span> </span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span>ID, <span class="sc">-</span>SEX, <span class="sc">-</span>AGE, <span class="sc">-</span>BloodCulture),</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"PARAMCD"</span>,</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"AVAL"</span>,</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_drop_na =</span> <span class="cn">FALSE</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>Add the parameter information such as labels and units on to the transformed data directly from the data dictionary. </span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>Derive additional variables and metadata are per the analysis plan such as:</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Units </span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Variable type</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Categories for sex</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>rename outcome </span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r transform, warning=FALSE, message=FALSE, echo=FALSE} </span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>bact_data02 <span class="ot">&lt;-</span> </span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>  bact_data01 <span class="sc">|&gt;</span> </span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bact_dd, <span class="at">by =</span> <span class="st">"PARAMCD"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">UNIT =</span> units,</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">TYPE =</span> <span class="fu">if_else</span>(scale_of_measurement <span class="sc">==</span> <span class="st">"continuous"</span>, <span class="st">"numeric"</span>, <span class="st">"NA"</span>), </span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">NOTE =</span> remark, </span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">NOTE2 =</span> from_paper,</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEXC =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>      SEX <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"male"</span>,</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>      SEX <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"female"</span>,</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">SUBJID =</span> ID <span class="sc">+</span> <span class="dv">100000</span>, </span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">USUBJID =</span> <span class="fu">paste0</span>(<span class="st">"DC-2019-0054-"</span>, SUBJID),</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste0</span>(label, <span class="st">" ("</span>, UNIT, <span class="st">")"</span>),</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">BACTEREMIA =</span> BloodCulture,</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">BACTEREMIAN =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>      BloodCulture <span class="sc">==</span> <span class="st">"no"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>      BloodCulture <span class="sc">==</span> <span class="st">"yes"</span> <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>bact_data02 <span class="sc">|&gt;</span> <span class="fu">glimpse</span>()</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>Select and re-roder the variables as per the data set specification. </span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r reorder, warning=FALSE, message=FALSE, echo=FALSE} </span></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Should come from the data set specification</span></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>bact_data03 <span class="ot">&lt;-</span> </span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>  bact_data02 <span class="sc">%&gt;%</span></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(USUBJID, SUBJID, AGE, SEX, SEXC, BACTEREMIA, BACTEREMIAN, PARAM, PARAMCD, AVAL, UNIT, TYPE, NOTE, NOTE2) <span class="sc">|&gt;</span></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(USUBJID, SUBJID, AGE, SEX, SEXC, BACTEREMIA, BACTEREMIAN, PARAM, PARAMCD, AVAL, UNIT, TYPE, NOTE, NOTE2)</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>bact_data03 <span class="sc">|&gt;</span> <span class="fu">glimpse</span>()</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>Add variable metadata as label attributes</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r meta_data, warning=FALSE, message=FALSE, echo=FALSE} </span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>SUBJID, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Patient Identifer"</span>  </span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>USUBJID, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Unique Patient Identifer with data souce reference: DC 2019-0054"</span>  </span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>SEX, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Patient gender"</span>  </span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>SEX, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Patient gender (Numeric coding, 1: male, 2: female)"</span>  </span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>SEXC, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Patient gender (Character coding)"</span>  </span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>AGE, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Patient age (years)"</span></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>BACTEREMIA, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Blood culture result for bacteremia (Character coding)"</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>BACTEREMIAN, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Blood culture result for bacteremia (Numeric coding, 0: No, 1: Yes)"</span></span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>PARAM, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Parameter name"</span></span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>PARAMCD, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Parameter code"</span></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>AVAL, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Parameter analysis value (Numeric)"</span></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>UNIT, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Parameter unit"</span></span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>TYPE, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Parameter: variable type (Numeric, Character)"</span></span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>NOTE, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Notes from source data dictionary - free text"</span></span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data03<span class="sc">$</span>NOTE2, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Remarks from source data dictionary - free text"</span></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>bact_data03 <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>Check we have not introduced any errors with the outcome variable. </span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r outcome_check, warning=FALSE, message=FALSE, echo=FALSE} </span></span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(bact_data02<span class="sc">$</span>BloodCulture)</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(bact_data03<span class="sc">$</span>BACTEREMIA)</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>Set flags for predictors as per the IDA plan:</span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>age (AGE), leukocytes (WBC), blood urea neutrogen (BUN), creatinine (CREA), thrombocytes (PLT), and neutrophiles (NEU) and these predictors will be included in the model as key predictors</span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Predictors of medium importance are potassium (POTASS), and some acute-phase related parameters such as fibrinogen (FIB), C-reactive protein (CRP), aspartate transaminase (ASAT), alanine transaminase (ALAT), and gamma-glutamyl transpeptidase (GGT).</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r set_flags, warning=FALSE, message=FALSE, echo=FALSE} </span></span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>bact_data04 <span class="ot">&lt;-</span></span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>  bact_data03 <span class="sc">|&gt;</span></span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">KEY_PRED_FL =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>      PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WBC"</span>, <span class="st">"BUN"</span>, <span class="st">"CREA"</span>, <span class="st">"PLT"</span>, <span class="st">"NEU"</span>) <span class="sc">~</span> <span class="st">"Y"</span></span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">MED_PRED_FL =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>      PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"POTASS"</span>, <span class="st">"FIB"</span>, <span class="st">"CRP"</span>, <span class="st">"ASAT"</span>, <span class="st">"ALAT"</span>, <span class="st">"GGT"</span>) <span class="sc">~</span> <span class="st">"Y"</span></span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">REM_PRED_FL =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a>      PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MCV"</span>, <span class="st">"HGB"</span>, <span class="st">"HCT"</span>, <span class="st">"MCH"</span>, <span class="st">"MCHC"</span>, <span class="st">"RDW"</span>, <span class="st">"MPV"</span>, <span class="st">"LYM"</span>, <span class="st">"MONO"</span>, <span class="st">"EOS"</span>, <span class="st">"BASO"</span>, <span class="st">"NT"</span>, <span class="st">"APTT"</span>, <span class="st">"SODIUM"</span>, <span class="st">"CA"</span>, <span class="st">"PHOS"</span>, <span class="st">"MG"</span>, <span class="st">"HS"</span>, <span class="st">"GBIL"</span>, <span class="st">"TP"</span>, <span class="st">"ALB"</span>, <span class="st">"AMY"</span>, <span class="st">"PAMY"</span>, <span class="st">"LIP"</span>, <span class="st">"CHE"</span>, <span class="st">"AP"</span>, <span class="st">"LDH"</span>, <span class="st">"CK"</span>, <span class="st">"GLU"</span>, <span class="st">"TRIG"</span>, <span class="st">"CHOL"</span>, <span class="st">"BASOR"</span>, <span class="st">"EOSR"</span>, <span class="st">"LYMR"</span>, <span class="st">"MONOR"</span>, <span class="st">"NEUR"</span>, <span class="st">"PDW"</span>, <span class="st">"RBC"</span>) <span class="sc">~</span> <span class="st">"Y"</span></span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data04<span class="sc">$</span>KEY_PRED_FL, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Key Predictor Flag"</span></span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data04<span class="sc">$</span>MED_PRED_FL, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Predictors of medium importance Flag"</span></span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data04<span class="sc">$</span>REM_PRED_FL, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Remaining Predictors Flag"</span></span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>bact_data04 <span class="sc">|&gt;</span> <span class="fu">glimpse</span>()</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a>TODO: something with this text?</span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>*"For example, leukocytes consist of five different types of blood cells (BASO, EOS, NEU, LYM and MONO), and the sum of the concentration of these types approximately (but not exactly) gives the leukocyte count, which is recorded in the variable WBC. Moreover, these variables are given as absolute counts and as percentages of the sum of the five variables, which creates some correlation. Some laboratory variables differ by sex and age, but the special selection of patients for this study (suspicion of bacteremia) may distort or alter the expected correlations with sex and age."*</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>Derive age groups: For the purpose of stratifying IDA results by age, age will be categorized into the following three groups: <span class="co">[</span><span class="ot">16, 50</span><span class="co">]</span>, (50, 65], (65, 101].</span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age_groups, warning=FALSE, message=FALSE, echo=FALSE} </span></span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a>bact_data05 <span class="ot">&lt;-</span></span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a>  bact_data04 <span class="sc">|&gt;</span></span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AGEGR01 =</span> <span class="fu">case_when</span>(AGE <span class="sc">&gt;=</span> <span class="dv">16</span>  <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">50</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>                           AGE <span class="sc">&gt;</span> <span class="dv">50</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>                           AGE <span class="sc">&gt;</span> <span class="dv">65</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">101</span> <span class="sc">~</span> <span class="dv">3</span>),</span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>         <span class="at">AGEGR01C =</span> <span class="fu">case_when</span>(AGEGR01 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"(16, 50]"</span>,</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>                              AGEGR01 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"(50, 65]"</span>,</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>                              AGEGR01 <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"(65, 101]"</span>))</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data05<span class="sc">$</span>AGEGR01, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Age group 01 (Numeric coding)"</span></span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(bact_data05<span class="sc">$</span>AGEGR01C, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Age group 01 (Character coding)"</span></span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a>Save the analysis data sets in to two linked data sets following a strucutre similar to the CDISC ADaM data standard. Individual patient measurements are stored in a data set called ADSL. The lab specifific data sets are stored in ADLB (a long format data set). </span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a>ADSL:</span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r save_adsl, warning=FALSE, message=FALSE, echo=FALSE} </span></span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a>ADSL <span class="ot">&lt;-</span> bact_data05 <span class="sc">%&gt;%</span></span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"WBC"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(USUBJID, SUBJID, AGE, AGEGR01, AGEGR01C, SEX, SEXC, BACTEREMIA, BACTEREMIAN)</span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(ADSL, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"ADSL_01.rds"</span>))</span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a>ADLB: *Note AGE is kept in ADLB as it is a key predictor*</span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r save_adlb, warning=FALSE, message=FALSE, echo=FALSE} </span></span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a>ADLB <span class="ot">&lt;-</span> bact_data05 <span class="sc">%&gt;%</span></span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>AGEGR01, <span class="sc">-</span>AGEGR01C, <span class="sc">-</span>SEX, <span class="sc">-</span>SEXC, <span class="sc">-</span>BACTEREMIA, <span class="sc">-</span>BACTEREMIAN)</span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(ADLB, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"ADLB_01.rds"</span>))</span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a>Note. At this point both ADSL and ADLB are intermediate files that will be used for further IDA. Findings in IDA may require updates to either data set. </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>